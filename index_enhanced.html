<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DS4200: Cryptocurrency vs Stock Market Analysis</title>
    
    <!-- D3.js for network visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Vega and Vega-Lite for Altair charts -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    
    <!-- Chart.js for matplotlib-style charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@2.0.1/dist/chartjs-chart-matrix.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        header p {
            font-size: 1.2em;
            opacity: 0.95;
        }
        
        .viz-section {
            padding: 40px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .viz-section:last-child {
            border-bottom: none;
        }
        
        .viz-section h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .viz-section .subtitle {
            color: #666;
            font-style: italic;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        
        .viz-container {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .interpretation {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
        }
        
        .interpretation h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .interpretation p {
            line-height: 1.6;
            color: #333;
        }
        
        canvas {
            max-width: 100%;
            height: auto;
        }
        
        /* Network visualization specific styles */
        #network {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            min-height: 700px;
        }
        
        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .node:hover {
            stroke-width: 3px;
        }
        
        .node.highlighted {
            stroke: #000;
            stroke-width: 3px;
        }
        
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
            transition: all 0.3s ease;
        }
        
        .link.highlighted {
            stroke: #555;
            stroke-opacity: 1;
            stroke-width: 3px;
        }
        
        .link.dimmed {
            stroke-opacity: 0.1;
        }
        
        .node-label {
            font-size: 11px;
            font-weight: 600;
            pointer-events: none;
            text-shadow: 0 1px 2px white, 1px 0 2px white, -1px 0 2px white, 0 -1px 2px white;
        }
        
        .legend {
            position: absolute;
            top: 30px;
            right: 30px;
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            font-size: 13px;
            z-index: 10;
        }
        
        .legend-item {
            margin: 8px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
            border: 2px solid #333;
        }
        
        .tooltip-viz {
            position: absolute;
            padding: 10px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            max-width: 200px;
            z-index: 100;
        }
        
        .network-instructions {
            text-align: center;
            color: #666;
            font-size: 13px;
            margin: 15px 0;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 5px;
        }
        
        footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 0.9em;
        }
        
        .key-findings {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .key-findings h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }
        
        .key-findings ul {
            list-style-position: inside;
            line-height: 1.8;
        }
        
        .key-findings li {
            margin-bottom: 10px;
        }
        
        #network-container {
            position: relative;
        }
        
        .interactive-note {
            background: #e3f2fd;
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
            font-size: 0.9em;
        }
        
        .interactive-note strong {
            color: #1976d2;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“Š Cryptocurrency vs. Stock Market Analysis</h1>
            <p>Comprehensive Visualization Dashboard - DS4200 Final Project</p>
        </header>
        
        <!-- Visualization 1: Market Performance Over Time -->
        <div class="viz-section">
            <h2>1. Market Performance Over Time</h2>
            <p class="subtitle">Normalized closing prices with interactive filtering and zoom</p>
            
            <div class="viz-container">
                <div id="timeSeriesChart"></div>
                <div class="interactive-note">
                    <strong>ðŸŽ® Interactive Features:</strong> 
                    <span style="color: #1976d2;">Click legend to toggle assets</span> â€¢ 
                    <span style="color: #1976d2;">Drag on chart to highlight time periods</span> â€¢ 
                    Hover for detailed tooltips
                </div>
            </div>
            
            <div class="interpretation">
                <h3>ðŸ“ˆ Interpretation</h3>
                <p>This time-series visualization displays normalized closing prices for SPY and five major cryptocurrencies, 
                allowing for direct performance comparison despite different price scales. All assets start at a baseline of 1.0. 
                The chart reveals that cryptocurrencies exhibit dramatically higher volatility and larger price swings compared to 
                SPY, which shows steady, gradual growth. Notable crypto bull runs and crashes are clearly visible, demonstrating 
                the high-risk, high-reward nature of digital assets. The divergence between traditional equities (SPY) and 
                cryptocurrencies highlights their distinct market behaviors and risk profiles.</p>
            </div>
        </div>
        
        <!-- Visualization 2: Volatility Distribution -->
        <div class="viz-section">
            <h2>2. Volatility Distribution Comparison</h2>
            <p class="subtitle">30-day rolling volatility with interactive selection</p>
            
            <div class="viz-container">
                <div id="volatilityChart"></div>
            </div>
            
            <div class="interpretation">
                <h3>ðŸ“Š Interpretation</h3>
                <p>This figure shows the distribution of 30-day rolling volatility for all assets. The boxplots summarize the central 
                50% of values while individual points mark extreme observations. SPY has the lowest and tightest volatility 
                range, with most values near 0.01. In contrast, all cryptocurrency assets display wider and higher distributions, 
                especially XRP-USD and LTC-USD, which show frequent large spikes. The interactive features allow you to explore 
                specific volatility ranges and compare assets directly.</p>
            </div>
        </div>
        
        <!-- Visualization 3: Volume-Price Relationship -->
        <div class="viz-section">
            <h2>3. Volumeâ€“Price Relationship</h2>
            <p class="subtitle">Trading volume vs. price with brush selection and dynamic regression</p>
            
            <div class="viz-container">
                <div id="volumePriceChart"></div>
                <div class="interactive-note">
                    <strong>ðŸŽ® Interactive Features:</strong> 
                    <span style="color: #1976d2;">Drag to select and zoom regions</span> â€¢ 
                    <span style="color: #1976d2;">Click legend to filter assets</span> â€¢ 
                    <span style="color: #1976d2;">Selected points enlarge</span> â€¢ 
                    Regression lines update dynamically
                </div>
            </div>
            
            <div class="interpretation">
                <h3>ðŸ’¹ Interpretation</h3>
                <p>This scatter plot displays the relationship between log-transformed trading volume (x-axis) and the average of daily high and low prices 
                (y-axis) for SPY and five major cryptocurrencies. Each point represents a single trading day, colored by asset, with regression lines 
                showing the overall trend for each ticker. The interactive legend allows users to highlight specific assets by clicking, while hover 
                tooltips provide detailed information including date, volume, and price metrics.</p>
                
                <p>The visualization reveals distinct patterns across asset classes. SPY exhibits a tight, linear relationship with relatively consistent 
                volume levels and stable pricing, reflecting the mature liquidity of the S&P 500. In contrast, cryptocurrencies display more dispersed 
                patterns with steeper regression slopes, particularly BTC-USD and ETH-USD, indicating that higher trading volumes often coincide with 
                significantly elevated price levels. XRP-USD, LTC-USD, and BNB-USD show intermediate patterns with greater scatter, suggesting more 
                volatile liquidity-price dynamics.</p>
                
                <p>The nonlinear bursts visible in crypto assetsâ€”clusters of high-volume, high-price pointsâ€”likely correspond to market events such as 
                bull runs, major announcements, or periods of speculative trading. This contrasts with SPY's steadier relationship, where volume and 
                price maintain a more predictable correlation. Overall, the chart illustrates that cryptocurrencies exhibit stronger liquidity-price 
                sensitivity and more dramatic market activity surges compared to traditional equities.</p>
            </div>
        </div>
        
        <!-- Visualization 4: Asset Correlation Heatmap -->
        <div class="viz-section">
            <h2>4. Asset Correlation Heatmap</h2>
            <p class="subtitle">Daily return correlations between all assets</p>
            
            <div class="viz-container">
                <canvas id="correlationChart"></canvas>
            </div>
            
            <div class="interpretation">
                <h3>ðŸ”— Interpretation</h3>
                <p>The correlation heatmap reveals the strength of relationships between daily returns of different assets. 
                Warmer colors (red) indicate positive correlations, while cooler colors (blue) indicate negative correlations. 
                Key observations include strong positive correlations among cryptocurrencies themselves, suggesting they often 
                move together as an asset class. SPY shows moderate correlation with some crypto assets, indicating some degree 
                of market integration, particularly during broader market stress events.</p>
            </div>
        </div>
        
        <!-- Visualization 5: Drivers Network Map -->
        <div class="viz-section">
            <h2>5. Drivers Network Map (D3.js)</h2>
            <p class="subtitle">Force-directed network showing asset-driver relationships</p>
            
            <div class="network-instructions">
                <strong>ðŸŽ¯ Interactive Features:</strong> Hover over nodes to highlight connections â€¢ Click to focus â€¢ 
                Drag nodes to reposition
            </div>
            
            <div class="viz-container">
                <div id="network-container">
                    <div id="network"></div>
                    <div class="legend">
                        <div style="font-weight: bold; margin-bottom: 10px;">Node Types</div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #4CAF50;"></div>
                            <span>Equity (SPY)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #2196F3;"></div>
                            <span>Cryptocurrency</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #FF9800;"></div>
                            <span>Driver/Company</span>
                        </div>
                    </div>
                    <div class="tooltip-viz" id="tooltip"></div>
                </div>
            </div>
            
            <div class="key-findings">
                <h3>ðŸ”‘ Key Insights from Network Analysis</h3>
                <ul>
                    <li><strong>Coinbase as Central Hub:</strong> Connected to 4 out of 5 cryptocurrencies, highlighting its role 
                    as critical infrastructure. Any regulatory or operational issues could create cascading effects across multiple 
                    crypto assets simultaneously.</li>
                    <li><strong>Binance's Dual Influence:</strong> Acts as both exchange platform and token issuer (BNB), creating 
                    unique interdependency where its operational health affects multiple assets.</li>
                    <li><strong>Traditional vs. Crypto Separation:</strong> SPY stands isolated, connected only to Apple, Microsoft, 
                    and Amazonâ€”demonstrating the distinct nature of traditional equity markets versus the interconnected crypto space.</li>
                    <li><strong>Structural Risk Concentration:</strong> Multiple cryptocurrencies depend on the same exchanges and 
                    service providers, meaning a failure at one driver entity could create systemic risk across the entire crypto 
                    portfolio.</li>
                    <li><strong>Limited True Diversification:</strong> The shared infrastructure dependencies reveal that holding 
                    multiple cryptocurrencies provides less diversification than price movements alone might suggest.</li>
                </ul>
            </div>
        </div>
        
        <footer>
            <p>&copy; 2025 DS4200 Final Project | Cryptocurrency vs. Stock Market Volatility Analysis</p>
            <p style="margin-top: 10px; font-size: 0.85em; opacity: 0.8;">
                Data Source: Yahoo Finance (yfinance) | Visualization Tools: D3.js, Vega-Lite (Altair), Chart.js
            </p>
        </footer>
    </div>
    
    <script>
        // ===== LOAD ENHANCED ALTAIR VISUALIZATIONS =====
        
        // Load Time Series with Enhanced Interactions
        fetch('time_series_spec_enhanced.json')
            .then(response => response.json())
            .then(spec => {
                vegaEmbed('#timeSeriesChart', spec, {
                    actions: {export: true, source: false, compiled: false, editor: false}
                });
            })
            .catch(error => console.error('Error loading time series:', error));
        
        // Load Enhanced Volatility Chart - Simple inline version
        const volatilitySpec = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "data": {"url": "volatility_data.csv"},
            "mark": {"type": "boxplot", "size": 50},
            "encoding": {
                "x": {
                    "field": "Ticker",
                    "type": "nominal",
                    "title": "Asset",
                    "sort": ["SPY", "BTC-USD", "ETH-USD", "XRP-USD", "LTC-USD", "BNB-USD"],
                    "axis": {"labelAngle": -45}
                },
                "y": {
                    "field": "Rolling_Volatility",
                    "type": "quantitative",
                    "title": "30-Day Rolling Volatility",
                    "scale": {"domain": [0, 0.15]}
                },
                "color": {
                    "field": "Ticker",
                    "type": "nominal",
                    "scale": {"scheme": "category10"},
                    "legend": {"title": "Asset"}
                }
            },
            "width": 700,
            "height": 400,
            "title": "Volatility Distribution Comparison"
        };
        
        vegaEmbed('#volatilityChart', volatilitySpec, {
            actions: {export: true, source: false, compiled: false, editor: false}
        }).catch(error => {
            console.error('Error rendering volatility chart:', error);
            document.getElementById('volatilityChart').innerHTML = 
                '<p style="color: red; padding: 20px;">Error: ' + error.message + '</p>';
        });
        
        // Load Enhanced Volume-Price Chart
        fetch('volume_price_spec_enhanced.json')
            .then(response => response.json())
            .then(spec => {
                vegaEmbed('#volumePriceChart', spec, {
                    actions: {export: true, source: false, compiled: false, editor: false}
                });
            })
            .catch(error => console.error('Error loading volume-price chart:', error));
        
        // ===== VISUALIZATION 4: Correlation Heatmap =====
        const correlationCtx = document.getElementById('correlationChart').getContext('2d');
        
        const assets = ["BNB-USD", "BTC-USD", "ETH-USD", "LTC-USD", "SPY", "XRP-USD"];
        const correlationMatrix = [[1.0, 0.6291093160456803, 0.6379804458366646, 0.5862309795889612, 0.2546823549655465, 0.46624069034046767], [0.6291093160456803, 1.0, 0.8033039702904642, 0.7077641119192842, 0.3754115624374634, 0.5447056263513879], [0.6379804458366646, 0.8033039702904642, 1.0, 0.736727999190702, 0.3931351340788075, 0.5608781179616397], [0.5862309795889612, 0.7077641119192842, 0.736727999190702, 1.0, 0.33564867508728363, 0.5937281464187953], [0.2546823549655465, 0.3754115624374634, 0.3931351340788075, 0.33564867508728363, 1.0, 0.25834714202006714], [0.46624069034046767, 0.5447056263513879, 0.5608781179616397, 0.5937281464187953, 0.25834714202006714, 1.0]];
        
        const heatmapData = [];
        for (let i = 0; i < assets.length; i++) {
            for (let j = 0; j < assets.length; j++) {
                heatmapData.push({
                    x: assets[j],
                    y: assets[i],
                    v: correlationMatrix[i][j]
                });
            }
        }
        
        const correlationChart = new Chart(correlationCtx, {
            type: 'matrix',
            data: {
                datasets: [{
                    label: 'Correlation',
                    data: heatmapData,
                    backgroundColor(context) {
                        const value = context.dataset.data[context.dataIndex].v;
                        const alpha = Math.abs(value);
                        return value >= 0 
                            ? `rgba(244, 67, 54, ${alpha})`
                            : `rgba(33, 150, 243, ${alpha})`;
                    },
                    borderWidth: 1,
                    borderColor: 'white',
                    width: ({chart}) => (chart.chartArea || {}).width / assets.length - 1,
                    height: ({chart}) => (chart.chartArea || {}).height / assets.length - 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                aspectRatio: 1,
                plugins: {
                    title: {
                        display: true,
                        text: 'Correlation Heatmap of Daily Returns',
                        font: { size: 18 }
                    },
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            title() { return ''; },
                            label(context) {
                                const item = context.dataset.data[context.dataIndex];
                                return `${item.y} vs ${item.x}: ${item.v.toFixed(2)}`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'category',
                        labels: assets,
                        offset: true,
                        ticks: {
                            display: true
                        },
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        type: 'category',
                        labels: assets,
                        offset: true,
                        reverse: true,
                        ticks: {
                            display: true
                        },
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
        
        // ===== VISUALIZATION 5: Drivers Network Map (D3.js) =====
        const drivers = {
            "SPY": ["Apple", "Microsoft", "Amazon"],
            "BTC-USD": ["Coinbase", "MicroStrategy", "Nvidia"],
            "ETH-USD": ["Coinbase", "Lido Finance", "Consensys"],
            "XRP-USD": ["Ripple", "Coinbase", "Binance"],
            "LTC-USD": ["Coinbase", "Antpool", "Bitmain"],
            "BNB-USD": ["Binance", "Binance Smart Chain projects", "Paxos"]
        };
        
        const nodes = [];
        const links = [];
        const node_ids = new Set();
        
        for (const [ticker, driverList] of Object.entries(drivers)) {
            if (!node_ids.has(ticker)) {
                const node_type = ticker === "SPY" ? "equity" : "crypto";
                nodes.push({
                    id: ticker,
                    name: ticker,
                    type: node_type,
                    group: node_type === "equity" ? 1 : 2
                });
                node_ids.add(ticker);
            }
        }
        
        for (const [ticker, driverList] of Object.entries(drivers)) {
            for (const driver of driverList) {
                if (!node_ids.has(driver)) {
                    nodes.push({
                        id: driver,
                        name: driver,
                        type: "driver",
                        group: 3
                    });
                    node_ids.add(driver);
                }
                
                links.push({
                    source: ticker,
                    target: driver,
                    value: 1
                });
            }
        }
        
        const networkData = { nodes, links };
        
        const width = 1000;
        const height = 700;
        
        const svg = d3.select("#network")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("viewBox", [0, 0, width, height]);
        
        const colorScale = d3.scaleOrdinal()
            .domain(["equity", "crypto", "driver"])
            .range(["#4CAF50", "#2196F3", "#FF9800"]);
        
        const simulation = d3.forceSimulation(networkData.nodes)
            .force("link", d3.forceLink(networkData.links)
                .id(d => d.id)
                .distance(80)
            )
            .force("charge", d3.forceManyBody()
                .strength(-300)
            )
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(30));
        
        const link = svg.append("g")
            .selectAll("line")
            .data(networkData.links)
            .join("line")
            .attr("class", "link")
            .attr("stroke-width", 2);
        
        const node = svg.append("g")
            .selectAll("g")
            .data(networkData.nodes)
            .join("g")
            .attr("class", "node")
            .call(drag(simulation));
        
        node.append("circle")
            .attr("r", d => d.type === "driver" ? 10 : 15)
            .attr("fill", d => colorScale(d.type))
            .attr("stroke", "#fff")
            .attr("stroke-width", 2);
        
        node.append("text")
            .attr("class", "node-label")
            .attr("dx", 0)
            .attr("dy", d => d.type === "driver" ? -15 : -20)
            .attr("text-anchor", "middle")
            .text(d => d.name)
            .style("font-size", d => d.type === "driver" ? "10px" : "12px");
        
        const tooltip = d3.select("#tooltip");
        
        node.on("mouseover", function(event, d) {
            const connectedNodes = new Set();
            connectedNodes.add(d.id);
            
            link.classed("dimmed", l => {
                if (l.source.id === d.id || l.target.id === d.id) {
                    connectedNodes.add(l.source.id);
                    connectedNodes.add(l.target.id);
                    return false;
                }
                return true;
            })
            .classed("highlighted", l => l.source.id === d.id || l.target.id === d.id);
            
            node.classed("highlighted", n => connectedNodes.has(n.id))
                .style("opacity", n => connectedNodes.has(n.id) ? 1 : 0.3);
            
            const connections = networkData.links
                .filter(l => l.source.id === d.id || l.target.id === d.id)
                .map(l => l.source.id === d.id ? l.target.name : l.source.name);
            
            tooltip.style("opacity", 1)
                .html(`
                    <strong>${d.name}</strong><br>
                    Type: ${d.type}<br>
                    Connections: ${connections.length}<br>
                    <small>${connections.join(", ")}</small>
                `)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        })
        .on("mouseout", function() {
            link.classed("dimmed", false)
                .classed("highlighted", false);
            node.classed("highlighted", false)
                .style("opacity", 1);
            tooltip.style("opacity", 0);
        });
        
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);
            
            node
                .attr("transform", d => `translate(${d.x},${d.y})`);
        });
        
        function drag(simulation) {
            function dragstarted(event) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                event.subject.fx = event.subject.x;
                event.subject.fy = event.subject.y;
            }
            
            function dragged(event) {
                event.subject.fx = event.x;
                event.subject.fy = event.y;
            }
            
            function dragended(event) {
                if (!event.active) simulation.alphaTarget(0);
                event.subject.fx = null;
                event.subject.fy = null;
            }
            
            return d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended);
        }
        
        console.log("All visualizations initialized!");
    </script>
</body>
</html>
